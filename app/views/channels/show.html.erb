<%- model_class = Channel -%>
<p class="pull-right">At <%= Time.now.getlocal.strftime("%F %R") %>, refresh every 3hrs</p>
<div class="page-header">
  <h1><%= @channel.title %></h1>
</div>

  <div class="media">
    <div class="media-left pull-left">
      <a href="#">
        <%= image_tag @channel.thumbnail_url, :class => "media-object" %>
      </a>
    </div>
    <div class="media-body">
      <h4 class="media-heading"><%= @channel.title %></h4>
      <%= @channel.description %>
    </div>
  </div>
<%= line_chart [
            {name: "Videos", data: @channel_stats.group_by_day(:created_at).maximum("video_count")}, 
            {name: "Views", data: @channel_stats.group_by_day(:created_at).maximum("view_count")},
            {name: "Subscribers", data: @channel_stats.group_by_day(:created_at).maximum("subscriber_count")}
              ] %>
<% if @channel_stats %>
<h3>Stats <small>채널 통계</small></h3>
<table class="table">
  <tr>
    <th>Date</th>
    <th style="text-align:right; padding-right:10px; ">Video #</th>
    <th style="text-align:right; padding-right:10px; ">View #</th>
    <th style="text-align:right; padding-right:10px; ">Comments #</th>
    <th style="text-align:right; padding-right:10px; ">Subscriber #</th>
  </tr>

<% delta = @channel_stats.first %>
<% @channel_stats.each_with_index do |stat, i| %>

  <tr >
    <td><%= stat.created_at.getlocal.strftime("%F %R") %></td>
    <td style="text-align:right; padding-right:10px; "><%= link_to number_with_delimiter(stat.video_count), channel_videos_path(@channel.id) %><%= num_diff(stat.video_count, delta.video_count) if i != 0  %></td>
    <td style="text-align:right; padding-right:10px; "><%= number_with_delimiter(stat.view_count) %><%= num_diff(stat.view_count, delta.view_count) if i != 0  %></td>
    <td style="text-align:right; padding-right:10px; "><%= number_with_delimiter(stat.comment_count) %><%= num_diff(stat.comment_count, delta.comment_count) if i != 0  %></td>
    <td  style="text-align:right; padding-right:10px; "><%= number_with_delimiter(stat.subscriber_count) %><%= num_diff(stat.subscriber_count, delta.subscriber_count) if i != 0  %></td>
  </tr>
<% delta = stat %>
<%  end %>
</table>
<% end %>
<h3>Playlist </h3>
<% if @playlists %>
  <table class="table">
    <tr>
      <th>Playlist Title</th>
      <th>Description</th>
      <th>Tags</th>
    </tr>
  <%  @playlists.order("published_at DESC").each do |pl| %>
    <tr >
      <td><%= link_to image_tag(pl.thumbnail_url), pl %><br/><%= pl.title %></td>
      <td><%= pl.description %></td>
      <td><%= pl.tags %></td>
    </tr>
  <%  end %>
</table>
<% end %>

<div class="row">
  <h3>Videos <small>최신 5개 비디오</small></h3>
  <% if @videos %>
    <%  @videos.each do |v| %>
      <div class="media">
        <div class="media-left pull-left">
          <a href="<%= video_path(v) %>">
            <%= image_tag(v.thumbnail_url, :class => "media-object") %>
          </a>
        </div>
        <div class="media-body">
          <h4 class="media-heading"><%= v.title %></h4>
          <%= v.description %>
          <%= "From #{v.published_at.to_date}" if v.published_at %>
        </div>
      </div>
    <%  end %>
  <% end %>
</div>
<div class="row">
    <ol class="breadcrumb">
      <li><%= link_to t('.back', :default => t("helpers.links.back")),
                  channels_path, :class => 'btn btn-default'  %></li>
      <li> <%= link_to t('.edit', :default => t("helpers.links.edit")),
                  edit_channel_path(@channel), :class => 'btn btn-default' %></li>
    </ol>
</div>
    <!-- <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                  channel_path(@channel),
                  :method => 'delete',
                  :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                  :class => 'btn btn-danger' %> -->


